<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦å²¡å¸‚ç¤¾ä¼šç§‘è¦‹å­¦ ãƒ«ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ãƒŠãƒ¼</title>
    <style>
        /* ã‚¹ã‚¿ã‚¤ãƒ«ã¯å‰å›ã¨åŒã˜ã§ã™ */
        body { font-family: "Helvetica Neue", Arial, sans-serif; padding: 20px; background-color: #f0f8ff; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { color: #007bff; text-align: center; font-size: 24px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], select { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 12px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; font-weight: bold; transition: background 0.3s; }
        button:hover { background-color: #218838; }
        
        /* çµæœè¡¨ç¤ºã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        #output { margin-top: 20px; background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 5px; display: none; }
        .route-path { font-size: 1.2em; color: #d9534f; font-weight: bold; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 2px dashed #ddd; }
        .schedule-text { line-height: 1.6; }
        .warning { color: orange; font-weight: bold; margin-top: 10px; }
        
        #map { height: 400px; width: 100%; margin-top: 20px; border-radius: 8px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸšŒ ç¤¾ä¼šç§‘è¦‹å­¦ ãƒ«ãƒ¼ãƒˆãƒ¡ãƒ¼ã‚«ãƒ¼</h1>
    <p style="text-align:center;">10:00 å¤©ç¥ç™º ã€œ 14:30 å¤©ç¥ç€</p>

    <div class="form-group">
        <label for="lunchOption">ğŸ± ãŠæ˜¼ã”é£¯ã¯ï¼Ÿ</label>
        <select id="lunchOption">
            <option value="ãŠå¼å½“ï¼ˆå…¬åœ’ãªã©ã§é£Ÿã¹ã‚‹ï¼‰">ãŠå¼å½“ï¼ˆå…¬åœ’ãªã©ã§é£Ÿã¹ã‚‹ï¼‰</option>
            <option value="é£²é£Ÿåº—ï¼ˆãŠåº—ã§é£Ÿã¹ã‚‹ï¼‰">é£²é£Ÿåº—ï¼ˆãŠåº—ã§é£Ÿã¹ã‚‹ï¼‰</option>
        </select>
    </div>

    <div class="form-group">
        <label for="extraSpot">â• è¿½åŠ ã§è¡ŒããŸã„å ´æ‰€ (ã‚ã‚Œã°)</label>
        <input type="text" id="extraSpot" placeholder="ä¾‹: ç¦å²¡PayPayãƒ‰ãƒ¼ãƒ ã€å¤§æ¿ å…¬åœ’ãªã©">
    </div>

    <button onclick="generateRoute()">ãƒ«ãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ (æ™‚åˆ»è¡¨å‚ç…§)</button>
    <div class="warning">
        â€»ç”Ÿæˆã®éš›ã€GeminiãŒç¾åœ¨ã®æ™‚åˆ»è¡¨ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§æ¤œç´¢ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚
    </div>

    <div id="output"></div>
    <div id="map"></div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAIyi4y1P8CNl0U0bEs4rYTw13yetuqEGs&callback=initMap" async defer></script>

<script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // â†“â†“â†“ ã“ã“ã«Gemini APIã‚­ãƒ¼ã‚’å…¥ã‚Œã¦ãã ã•ã„ â†“â†“â†“
    const API_KEY = "AIzaSyAu845D92cgiECPDfzPD1VRN8c0NU1tAN8";
    
    window.generateRoute = async function() {
        const lunch = document.getElementById('lunchOption').value;
        const extra = document.getElementById('extraSpot').value;
        const outputDiv = document.getElementById('output');
        
        // èª­ã¿è¾¼ã¿ä¸­è¡¨ç¤º
        outputDiv.style.display = 'block';
        outputDiv.innerHTML = "â³ GeminiãŒ**æ™‚åˆ»è¡¨ã‚’å‚ç…§ã—ã¦**æœ€é©ãªãƒ«ãƒ¼ãƒˆã‚’è€ƒãˆã¦ã„ã¾ã™...<br>ï¼ˆ10ã€œ20ç§’ã»ã©ãŠå¾…ã¡ãã ã•ã„ï¼‰";

        const genAI = new GoogleGenerativeAI(API_KEY);
        // â˜… ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦Webæ¤œç´¢ï¼ˆGoogle Search Toolï¼‰ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ â˜…
        const model = genAI.getGenerativeModel({ 
            model: "gemini-2.5-flash",
            config: {
                tools: [{ googleSearch: {} }],
            },
        });

        // â˜… ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ™‚åˆ»è¡¨å‚ç…§ã®æŒ‡ç¤ºã‚’è¿½åŠ ã—ã¾ã—ãŸ â˜…
        const prompt = `
            ã‚ãªãŸã¯ç¦å²¡å¸‚ã®ä¿®å­¦æ—…è¡Œã‚¬ã‚¤ãƒ‰ã§ã™ã€‚ä»¥ä¸‹ã®ä¸­å­¦ç”Ÿã®ç¤¾ä¼šç§‘è¦‹å­¦ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
            **å¿…ãšWebæ¤œç´¢ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ç¦å²¡å¸‚åœ°ä¸‹é‰„ç©ºæ¸¯ç·šã®æ™‚åˆ»è¡¨ã‚’å‚ç…§ã—ã€å®Ÿéš›ã®ç§»å‹•æ™‚é–“ï¼ˆä¹—è»Šã€ä¹—ã‚Šæ›ãˆã€å¾…ã¡æ™‚é–“ï¼‰ã‚’è¨ˆç®—ã—ã¦ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åæ˜ ã•ã›ã¦ãã ã•ã„ã€‚**

            ã€æ¡ä»¶ã€‘
            - é–‹å§‹: 10:00 å¤©ç¥
            - çµ‚äº†: 14:30 å¤©ç¥
            - å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ: ç¦å²¡å¸‚åšç‰©é¤¨ã€ç¦å²¡å¸‚ç¾è¡“é¤¨ã€ç¦å²¡ã‚¿ãƒ¯ãƒ¼
            - è¿½åŠ ç›®çš„åœ°: ${extra ? extra : "ãªã—"}
            - æ˜¼é£Ÿã‚¹ã‚¿ã‚¤ãƒ«: ${lunch}
            - ç§»å‹•æ‰‹æ®µ: åœ°ä¸‹é‰„ç©ºæ¸¯ç·šã‚’ãƒ¡ã‚¤ãƒ³ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚ï¼ˆåšç‰©é¤¨ãƒ»ã‚¿ãƒ¯ãƒ¼ã®æœ€å¯„ã‚Šã¯è¥¿æ–°é§…ã€ç¾è¡“é¤¨ã®æœ€å¯„ã¯å¤§æ¿ å…¬åœ’é§…ã¨ã™ã‚‹ã“ã¨ï¼‰
            
            ã€å‡ºåŠ›å½¢å¼ã€‘
            ä»¥ä¸‹ã®JSONå½¢å¼ã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•(backtick)ã¯ä¸è¦ã§ã™ã€‚å¿…ãšJSONã¨ã—ã¦æœ‰åŠ¹ãªå½¢å¼ã«ã—ã¦ãã ã•ã„ã€‚
            {
                "schedule": "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è©³ç´°ãƒ†ã‚­ã‚¹ãƒˆã€‚**æ™‚åˆ»ã¯åœ°ä¸‹é‰„ã®æ™‚åˆ»è¡¨ã«åŸºã¥ã„ã¦**å…·ä½“çš„ã«è¨˜è¿°ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 10:05 å¤©ç¥é§…ç™º â†’ 10:11 å¤§æ¿ å…¬åœ’é§…ç€ï¼‰ã€‚",
                "coordinates": [
                    {"lat": 33.590, "lng": 130.400, "name": "å¤©ç¥(ã‚¹ã‚¿ãƒ¼ãƒˆ)"},
                    {"lat": 33.xxx, "lng": 130.xxx, "name": "æ¬¡ã®å ´æ‰€"},
                    ... (å›ã‚‹é †ç•ªã«ç·¯åº¦çµŒåº¦ã‚’ãƒªã‚¹ãƒˆåŒ–),
                    {"lat": 33.590, "lng": 130.400, "name": "å¤©ç¥(ã‚´ãƒ¼ãƒ«)"}
                ]
            }
        `;

        try {
            const result = await model.generateContent(prompt);
            const response = await result.response;
            const text = response.text();
            
            // JSONã®æ•´å½¢
            const jsonStr = text.replace(/```json|```/g, "").trim();
            const data = JSON.parse(jsonStr);

            // åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å ´æ‰€ã®åå‰ã ã‘ã‚’å–ã‚Šå‡ºã—ã¦ã€Œâ†’ã€ã§ã¤ãªã
            const routeText = data.coordinates.map(loc => loc.name).join(" â†’ ");

            // ç”»é¢ã¸ã®è¡¨ç¤º
            outputDiv.innerHTML = `
                <h3>ğŸ“ ãƒ«ãƒ¼ãƒˆé †è·¯</h3>
                <div class="route-path">${routeText}</div>
                
                <h3>ğŸ“… è©³ã—ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« (æ™‚åˆ»è¡¨å‚ç…§æ¸ˆã¿)</h3>
                <div class="schedule-text">${data.schedule.replace(/\n/g, '<br>')}</div>
            `;

            // åœ°å›³ã®æ›´æ–°
            updateMap(data.coordinates);

        } catch (error) {
            console.error(error);
            outputDiv.innerHTML = `
                <div style="color:red;">
                    âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚<br>
                    GeminiãŒæ™‚åˆ»è¡¨ã®æƒ…å ±ã‚’ã†ã¾ãå‡¦ç†ã§ããªã‹ã£ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚‚ã†ä¸€åº¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚<br>
                    ã‚¨ãƒ©ãƒ¼å†…å®¹: ${error.message}
                </div>
            `;
        }
    }
</script>

<script>
    // Google Mapã®åˆæœŸè¨­å®šã¨æ›´æ–°é–¢æ•°ï¼ˆå¤‰æ›´ãªã—ï¼‰
    let map;
    function initMap() {
        const fukuoka = { lat: 33.589, lng: 130.402 };
        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 12,
            center: fukuoka,
        });
    }

    function updateMap(locations) {
        if (!locations || locations.length === 0) return;

        const center = locations[0];
        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 13,
            center: { lat: center.lat, lng: center.lng },
        });

        const pathCoordinates = [];

        locations.forEach((loc, index) => {
            new google.maps.Marker({
                position: { lat: loc.lat, lng: loc.lng },
                map: map,
                label: (index + 1).toString(),
                title: loc.name
            });
            pathCoordinates.push({ lat: loc.lat, lng: loc.lng });
        });

        const tripPath = new google.maps.Polyline({
            path: pathCoordinates,
            geodesic: true,
            strokeColor: "#FF0000",
            strokeOpacity: 0.8,
            strokeWeight: 4,
        });

        tripPath.setMap(map);
    }
</script>

</body>
</html>
